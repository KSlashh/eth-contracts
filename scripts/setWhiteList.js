const { ethers } = require("hardhat");
const hre = require("hardhat");
const fs = require("fs");
const Web3 = require("web3");
const colors = require('colors');
const { expect } = require("chai");
hre.web3 = new Web3(hre.network.provider);


async function main() {

    [sender] = await hre.ethers.getSigners();
  
    let polyId;
    let _ccm;
    let fromContractWhiteList;
    let contractMethodWhiteList;
  
    // check polyId
    await getPolyChainId().then((_polyId) => {
      polyId = _polyId;
      console.log("\nUpdate EthCrossChainManager on chain with Poly_Chain_Id:".cyan, _polyId);
    }).catch((error) => {
      throw error;
    });;
  
    try {
      _ccm = getCCM(polyId);
    } catch(error) {
      throw error;
    }
  
    try {
      [fromContractWhiteList,contractMethodWhiteList] = getWhiteListInfo(polyId);
    } catch(error) {
      throw error;
    }
  
    const CCM = await hre.ethers.getContractFactory("EthCrossChainManager");    
    let ccm = CCM.attach(_ccm);
    let whiteLister = await ccm.whiteLister();
    if (sender != whiteLister) {
        console.error(sender," is no whiteLister! whiteLister is : ",whiteLister)
        throw
    }
   
    console.log("Start , whiteLister:".cyan, deployer.address.blue);

    tx = await ccm.setFromContractWhiteList(fromContractWhiteList);
    await tx.wait();
    tx = await ccm.setContractMethodWhiteList(contractMethodWhiteList);
    await tx.wait();
  
    console.log("\nDone.\n".magenta);
  
  }
  
  function getCCM(polyId) {
    switch (polyId) {
      case 2 : //eth
        ccm = '0x14413419452Aaf089762A0c5e95eD2A13bBC488C';
        return ccm;
  
      case 6 : //bsc
        ccm = '0x1c9Ca8aBb5da65d94DaD2E8Fb3f45535480d5909';
        return ccm;
  
      case 7 : //heco
        ccm = '0x7109c5F898C5667941B3D2A6451b4bFBeD2bdBbF';
        return ccm;
  
      case 12 : //ok
        ccm = '0x6CE66Cf89A17B5C22e757cca01beAD901fC8C7f2';
        return ccm;
  
      case 17 : //polygon
        ccm = '0xB16FED79a6Cb9270956f045F2E7989AFfb75d459';
        return ccm;
  
      case 19 : //arbitrum
        ccm = '0x7ceA671DABFBa880aF6723bDdd6B9f4caA15C87B';
        return ccm;
  
      default :
      throw new Error("fail to get DeployedContract, unknown Network: "+polyId);
    }
  }
  
  function getWhiteListInfo(polyId) {
    switch (polyId) {
    //   case 2 : //eth
    //     fromContractWhiteList = [];
    //     contractMethodWhiteList = [];
    //     return [fromContractWhiteList,contractMethodWhiteList];
  
      case 6 : //bsc
        fromContractWhiteList = [
            '0xF66016aC71a92d276AE9925751370cC7629AA229',
            '0x84CCeB386550Cb42812F01658433c4eCb3fEF44B',
            '0xCd8000DDD6D123451c987581439e1778b0b53B6e',
            '0xffd2F4ff2F110BD88BA9a4d9738F57F11F3942e9',
            '0x5Ec171C7fF16a4A7da37c1Eeb32CE50Bc1adFa9B'
        ];
        contractMethodWhiteList = [
            '0x000000000000000000000000f66016ac71a92d276ae9925751370cc7629aa229000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000f6f6e43726f73735472616e736665720000000000000000000000000000000000',
            '0x00000000000000000000000084cceb386550cb42812f01658433c4ecb3fef44b000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000f6f6e43726f73735472616e736665720000000000000000000000000000000000',
            '0x000000000000000000000000cd8000ddd6d123451c987581439e1778b0b53b6e000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000f6f6e43726f73735472616e736665720000000000000000000000000000000000',
            '0x000000000000000000000000ffd2f4ff2f110bd88ba9a4d9738f57f11f3942e9000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000f6f6e43726f73735472616e736665720000000000000000000000000000000000',
            '0x0000000000000000000000005ec171c7ff16a4a7da37c1eeb32ce50bc1adfa9b000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000f6f6e43726f73735472616e736665720000000000000000000000000000000000'
        ];      
        return [fromContractWhiteList,contractMethodWhiteList];
  
      case 7 : // heco
        fromContractWhiteList = [
            '0x39349D293eEFf636cCFBabf3632B3f8Abbe3201a',
            '0x5b7eCB86F6A0A13c9dFB3a2572d3DC8F2D82C5eF',
            '0x28311734d9fc560035f9ae56dC8940c3197A8eB2',
            '0xf3BECA932c2d35bEF19e9ca3460EE91Cb3813d05',
            '0xC73604B6F7f877e29f35f6f1d5B241E900632033'          
        ];
        contractMethodWhiteList = [
            '0x00000000000000000000000039349d293eeff636ccfbabf3632b3f8abbe3201a000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000f6f6e43726f73735472616e736665720000000000000000000000000000000000',
            '0x0000000000000000000000005b7ecb86f6a0a13c9dfb3a2572d3dc8f2d82c5ef000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000f6f6e43726f73735472616e736665720000000000000000000000000000000000',
            '0x00000000000000000000000028311734d9fc560035f9ae56dc8940c3197a8eb2000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000f6f6e43726f73735472616e736665720000000000000000000000000000000000',
            '0x000000000000000000000000f3beca932c2d35bef19e9ca3460ee91cb3813d05000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000f6f6e43726f73735472616e736665720000000000000000000000000000000000',
            '0x000000000000000000000000c73604b6f7f877e29f35f6f1d5b241e900632033000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000f6f6e43726f73735472616e736665720000000000000000000000000000000000'          
        ];      
        return [fromContractWhiteList,contractMethodWhiteList];
  
      case 12 : // ok
        fromContractWhiteList = [
            '0xc4a937E3fe940226A5C4372b0563C6c2Ac76F542',
            '0xe26dC64f1B833ee829B431B0293C9EB677E60730',
            '0xEc90274Bca42C2FEb76986D6EF54d662ba2aE0Ae',
            '0x3ccFDc23678df1f5C74850EEe339d659307461eb',
            '0x0c9145FFC4269e8658db245080535a48c15eaf84'
        ];
        contractMethodWhiteList = [
            '0x000000000000000000000000c4a937e3fe940226a5c4372b0563c6c2ac76f542000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000f6f6e43726f73735472616e736665720000000000000000000000000000000000',
            '0x000000000000000000000000e26dc64f1b833ee829b431b0293c9eb677e60730000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000f6f6e43726f73735472616e736665720000000000000000000000000000000000',
            '0x000000000000000000000000ec90274bca42c2feb76986d6ef54d662ba2ae0ae000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000f6f6e43726f73735472616e736665720000000000000000000000000000000000',
            '0x0000000000000000000000003ccfdc23678df1f5c74850eee339d659307461eb000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000f6f6e43726f73735472616e736665720000000000000000000000000000000000',
            '0x0000000000000000000000000c9145ffc4269e8658db245080535a48c15eaf84000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000f6f6e43726f73735472616e736665720000000000000000000000000000000000'
        ];      
        return [fromContractWhiteList,contractMethodWhiteList];
  
      case 17 : // polygon
        fromContractWhiteList = [
            '0xF132d0e69ab7B2186d65a6af2bE1F2070FA428EC',
            '0x386eE1360a4bad8Bf9ec802Fb2417B97826e97b7',
            '0x3B7dFBAdC0DF01E08D2302BE6c47B3677AA23E1E',
            '0xCfAE5AfBceC88959A7Bfa2560B2D0DB03409Ad39',
            '0x8BdC3f698Bd1F9aA0C9868D1b603Eb2DCF185a67'
        ];
        contractMethodWhiteList = [
            '0x000000000000000000000000f132d0e69ab7b2186d65a6af2be1f2070fa428ec000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000f6f6e43726f73735472616e736665720000000000000000000000000000000000',
            '0x000000000000000000000000386ee1360a4bad8bf9ec802fb2417b97826e97b7000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000f6f6e43726f73735472616e736665720000000000000000000000000000000000',
            '0x0000000000000000000000003b7dfbadc0df01e08d2302be6c47b3677aa23e1e000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000f6f6e43726f73735472616e736665720000000000000000000000000000000000',
            '0x000000000000000000000000cfae5afbcec88959a7bfa2560b2d0db03409ad39000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000f6f6e43726f73735472616e736665720000000000000000000000000000000000',
            '0x0000000000000000000000008bdc3f698bd1f9aa0c9868d1b603eb2dcf185a67000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000f6f6e43726f73735472616e736665720000000000000000000000000000000000'
        ];
        return [fromContractWhiteList,contractMethodWhiteList];
  
      case 19 : // arbitrum
        fromContractWhiteList = [
            '0xf14a7d43bedaC1C17Da9C22cf3D8c900AA8DEcA9',
            '0x9800c0EB44cCb5423bb95205921fCb5FFa066a62',
            '0xa61E289C29c47A2EEA7092355602De8A0dCB16e2',
            '0x3803e2A56F657922b76211ab22eAFE6C0Aa4F95f',
            '0x303E57962D735A8dfC7CA5d30676d48A63AF7338',
            '0x5601D189D5751e4f9dde2E598999228B4a5DB9e2',
            '0x58EEac66d46d90Cc1c563CABc2c77D610B91284c',
            '0xd397a9F470212d419AcEC535783aeD8145E58853',
            '0xaeD9013944dFD09a16e5c4115ce45c48520383CE',
            '0x8E95320156C4d005a39089aD3FBc672A2204e5F6',
            '0xE1587c2613C4c2fCD5ec9bcf2E0970Bac47f849E',
            '0xb3b0657B15A0397286c5dEF400Df53859Cd6dB38',
            '0x949Edc17655Dec75B80DF08858Cb9Dd15662a9b3',
            '0x8385c76F0F9Fa6e552aB3DA3CbE04e374ae94FD1',
            '0x2Fd6E5618d207241277D45f206bccE32A5cfb6fF',
            '0xFB54e3A56242CD9225e3aec36d4d3CfAE78E1369',
            '0x51dbBD0fDc25317C7ADC8D0e287e8C34279E1c5D',
            '0xEE8b89D030eCD113F8f3dA2B9F2749c7CcEb7038',
            '0x8649588e71d0eb8b1cF73c7E81E3DFc7dBE06190',
            '0x947892356303DCf7DacDeb22bd45ee81dc14ffd2'
        ];
        contractMethodWhiteList = [
            '0x000000000000000000000000f14a7d43bedac1c17da9c22cf3d8c900aa8deca9000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000f6f6e43726f73735472616e736665720000000000000000000000000000000000',
            '0x0000000000000000000000009800c0eb44ccb5423bb95205921fcb5ffa066a62000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000f6f6e43726f73735472616e736665720000000000000000000000000000000000',
            '0x000000000000000000000000a61e289c29c47a2eea7092355602de8a0dcb16e2000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000f6f6e43726f73735472616e736665720000000000000000000000000000000000',
            '0x0000000000000000000000003803e2a56f657922b76211ab22eafe6c0aa4f95f000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000f6f6e43726f73735472616e736665720000000000000000000000000000000000',
            '0x000000000000000000000000303e57962d735a8dfc7ca5d30676d48a63af7338000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000f6f6e43726f73735472616e736665720000000000000000000000000000000000',
            '0x0000000000000000000000005601d189d5751e4f9dde2e598999228b4a5db9e2000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000f6f6e43726f73735472616e736665720000000000000000000000000000000000',
            '0x00000000000000000000000058eeac66d46d90cc1c563cabc2c77d610b91284c000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000f6f6e43726f73735472616e736665720000000000000000000000000000000000',
            '0x000000000000000000000000d397a9f470212d419acec535783aed8145e58853000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000f6f6e43726f73735472616e736665720000000000000000000000000000000000',
            '0x000000000000000000000000aed9013944dfd09a16e5c4115ce45c48520383ce000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000f6f6e43726f73735472616e736665720000000000000000000000000000000000',
            '0x0000000000000000000000008e95320156c4d005a39089ad3fbc672a2204e5f6000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000f6f6e43726f73735472616e736665720000000000000000000000000000000000',
            '0x000000000000000000000000e1587c2613c4c2fcd5ec9bcf2e0970bac47f849e000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000f6f6e43726f73735472616e736665720000000000000000000000000000000000',
            '0x000000000000000000000000b3b0657b15a0397286c5def400df53859cd6db38000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000f6f6e43726f73735472616e736665720000000000000000000000000000000000',
            '0x000000000000000000000000949edc17655dec75b80df08858cb9dd15662a9b3000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000f6f6e43726f73735472616e736665720000000000000000000000000000000000',
            '0x0000000000000000000000008385c76f0f9fa6e552ab3da3cbe04e374ae94fd1000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000f6f6e43726f73735472616e736665720000000000000000000000000000000000',
            '0x0000000000000000000000002fd6e5618d207241277d45f206bcce32a5cfb6ff000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000f6f6e43726f73735472616e736665720000000000000000000000000000000000',
            '0x000000000000000000000000fb54e3a56242cd9225e3aec36d4d3cfae78e1369000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000f6f6e43726f73735472616e736665720000000000000000000000000000000000',
            '0x00000000000000000000000051dbbd0fdc25317c7adc8d0e287e8c34279e1c5d000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000f6f6e43726f73735472616e736665720000000000000000000000000000000000',
            '0x000000000000000000000000ee8b89d030ecd113f8f3da2b9f2749c7cceb7038000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000f6f6e43726f73735472616e736665720000000000000000000000000000000000',
            '0x0000000000000000000000008649588e71d0eb8b1cf73c7e81e3dfc7dbe06190000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000f6f6e43726f73735472616e736665720000000000000000000000000000000000',
            '0x000000000000000000000000947892356303dcf7dacdeb22bd45ee81dc14ffd2000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000f6f6e43726f73735472616e736665720000000000000000000000000000000000'
        ];
        return [fromContractWhiteList,contractMethodWhiteList];
  
      default :
        throw new Error("fail to get WhiteListInfo, unknown or unset Network: "+polyId);
    }
  }
  
  async function getPolyChainId() {
    const chainId = await hre.web3.eth.getChainId();
    switch (chainId) {
      
      // mainnet
      case 1: // eth-main
        return 2;
      case 56: // bsc-main
        return 6;
      case 128: // heco-main
        return 7;
      case 137: // polygon-main
        return 17;
      case 66: // ok-main
        return 12;
      case 1718: // plt-main
        return 8;
      case 42161: // arbitrum-main
        return 19;
  
      // testnet
      case 3: // eth-test
        return 2;
      case 97: // bsc-test
        return 79;
      case 256: // heco-test
        return 7;
      case 80001: // polygon-test
        return 202;
      case 65: // ok-test
        return 200;
      case 101: // plt-test
        return 107;
      case 421611: // arbitrum-test
        return 205;
  
      // hardhat devnet
      case 31337:
        return 77777;
  
      // unknown chainid
      default: 
        throw new Error("fail to get Poly_Chain_Id, unknown Network_Id: "+chainId);
    }
  }
  
  // We recommend this pattern to be able to use async/await everywhere
  // and properly handle errors.
  main()
    .then(() => process.exit(0))
    .catch((error) => {
      console.error(error);
      process.exit(1);
    });
  